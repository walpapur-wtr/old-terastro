<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="./img/fon/terastro.jpg">
    <title>Каталог</title>
</head>

<body>
    <div class="wrapper">
        <header class="header">
            <div class="container">
                <div class="header_body">
                    <div class="header_burger">
                        <span></span>
                    </div>
                    <nav class="header_menu">
                        <ul class="header_list">
                            <li class="list_item">
                                <a href="./index.html" class="header_link">Головна</a>
                            </li>
                            <li class="list_item">
                                <a href="./ter_astro_page.html" class="header_link">Терастро</a>
                            </li>
                            <li class="list_item">
                                <a href="./nebozvid_page.html" class="header_link">Небозвід</a>
                            </li>
                            <li class="list_item">
                                <a href="./lsao_page.html" class="header_link">Lsao</a>
                            </li>
                            <li class="list_item">
                                <a class="dropdown-toggle header_link" data-bs-toggle="dropdown" href="./catalog.html" role="button" aria-expanded="false" >Статті</a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item drop_little header_link" href="catalog.html?category=Про учасників">Про учасників</a></li>
                                    <li><a class="dropdown-item drop_little header_link" href="catalog.html?category=Події">Події</a></li>
                                    <li><a class="dropdown-item drop_little header_link" href="catalog.html?category=ЗМІ про нас">ЗМІ про нас</a></li>
                                    <li><a class="dropdown-item drop_little header_link" href="catalog.html?category=Блог">Блог</a></li>
                                </ul>
                            </li>
                            <li class = "list_item">
                            <a class="dropdown-toggle header_link" data-bs-toggle="dropdown" href="./astrophoto.html" role="button" aria-expanded="false" >Галерея</a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item drop_little header_link" href="./astrophoto.html">Астрофото</a></li>
                                    <li><a class="dropdown-item drop_little header_link" href="./astrovideo.html">Астровідео</a></li>
                                </ul>
                            </li>
                            <li class="list_item">
                                <a href="./white_swan_page.html" class="header_link">White swan</a>
                            </li>
                            <li class="list_item">
                                <a href="./tsikavi_pos_page.html" class="header_link">Цікаві посилання</a>
                            </li>
                            <li class="list_item">
                                <a href="./contacts_page.html" class="header_link">Контакти</a>
                            </li>
                        </ul>
                    </nav>
                </div>
                <div class="focus_box">
                    <p class="focus_word">
                      Каталог статтей
                    </p>
                </div>
            </div>
        </header>
        <div class="backround-img">
            <div class="overley">
                <!-- /*****************************/ -->
            </div>
            <img src="./img/fon/Lsao.jpg" alt="backround images" class="background">
        </div>
    <style>
        .navigation {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
                /* Оновлена стилізація для підменю */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropbtn {
            background-color: #007bff;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            text-align: center;
            font-size: 16px;
            cursor: pointer;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            top: 100%; /* Розташування підменю під кнопкою */
        }

        .dropdown-content a {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #ddd;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .dropdown:hover .dropbtn {
            background-color: #0056b3;
        }

        .navigation-button{
            width: 250px;
            height: 50px;
            margin: 40px 50px 40px 0;
            border-radius: 8px;
            background-color: #cccccc;
            box-shadow: 1px 1px 14px 0px rgba(87, 87, 87, 0.4);
        }
        .navigation-button:hover{
            background-color: #737373;
            color:white;
            transition: 0.6s;
        }
        .article-container {
            padding-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            flex-wrap: wrap;
            display: flex;
            margin-bottom: 50px;
            margin: -60px 0 -0 0 ;
            transition: all 0.5s ease; 
            animation: block 3s 1;
        }
        h2.titleElement{
            color: rgb(65, 65, 65);
            font-weight: bold;
            font-size: 22px;
            margin: 0;
        }
        .article-block:hover h2{
            color: rgb(106, 0, 255);
            transition: 0.4s;
        }
        .article-block {
            height: 100%;
            width: 300px;
            margin: 40px 10px 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); 
            padding: 20px 30px;
            color: #000000;
            transition: transform 0.5s;
            overflow: hidden;
        }

        .article-block h2 {
            color: rgb(65, 65, 65);
            font-weight: bold;
            font-size: 22px;
            margin: 0;
        }

        .body_articles p {
            line-height: 1.5;
            overflow: hidden;
            text-overflow: ellipsis; 
            color: rgb(54, 54, 54);
            font-size: 16px;
        }

        .article-block img {
            max-width: 100%;
            height: auto;
            margin-top: 10px;
            cursor: pointer;
        }

        button.view-button {
            width: 100%;
            height: 40px;
            background-color: #cccccc;
            color: #2d2d2d;
            /* border: none; */
            border-radius: 8px;
            box-shadow: 1px 1px 10px 0px rgba(0, 0, 0, 0.25); 
            cursor: pointer;
            font-style: bold;
            transition: 0.6s;

        }

        .view-button:hover {
            background-color: #575757;
            color: white;
            transition: 0.6s;
        }
    </style>

<main>
    <div class="content">
        <div class="container">
            <div class="content_text">
                <div class="navigation">
                    <a href="create_article.html"><button class="navigation-button">Створити статтю</button></a>
                    <a href="catalog.html"><button class="navigation-button">Подивитися каталог</button></a>
                </div>
                <h1 class="title">Каталог статей</h1>
                <!-- Додайте контейнер для відображення статей -->
                <div class="article-container" id="articlesContainer">
                    
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer_body">
                <div class="footer_text">
                    <h4>Про нас</h4>
                    <div class="footer_texr">
                        <p>
                            Клуб любителів астрономії “ТерАстро”.
                            Астрономічне товариство Тернопільського району “Небозвід”.
                        </p>
                    </div>    
                </div>
                <div class="logo">
                    <img src="./img/logo/logo1.jpg" alt="Логотип">
                </div>
                <div class="footer_social_network">
                    <a href="https://facebook.com/groups/astroTernopil/" target="_blank">
                        <img src="./img/for footer/facebook.png" alt="Посилання на фейсбук">
                    </a>
                    <a href="https://instagram.com/astroternopil/" target="_blank">
                        <img src="./img/for footer/instagram.png" alt="Посилання на інстаграм">
                    </a>
                    <a href="https://nebozvid.blogspot.com/" target="_blank">
                        <img src="./img/for footer/blog-text.png" alt="Посилання на блогспот">
                    </a>
                    <a href="mailto:terastro2017@gmail.com">
                        <img src="./img/for footer/envelope.png" alt="Напишіть нам!">
                    </a>
                </div>
            </div>  
        </div>       
    </footer>
    <script src="script.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Отримайте параметр category з URL
            var urlParams = new URLSearchParams(window.location.search);
            var selectedCategory = urlParams.get("category") || "Про учасників"; // За замовчуванням "Про учасників"
            // Видаліть попередні дані
            var articlesContainer = document.getElementById("articlesContainer");
            articlesContainer.innerHTML = "";
            loadArticlesByCategory(selectedCategory);

            // Додайте обробник події для фільтрації статей за категорією
            var categoryFilter = document.getElementById("categoryFilter");
            categoryFilter.addEventListener("change", function () {
                var selectedCategory = categoryFilter.value;
                // Видаліть попередні дані
                articlesContainer.innerHTML = "";
                loadArticlesByCategory(selectedCategory);
            });

            // Додайте обробник події для кліку на категорію статей
            var categoryLinks = document.querySelectorAll(".dropdown-content a");
            categoryLinks.forEach(function(link) {
                link.addEventListener("click", function(event) {
                    event.preventDefault();
                    var selectedCategory = event.target.getAttribute("data-category");
                    loadArticlesByCategory(selectedCategory);
                    // Додайте перехід на каталог статей з вибраною категорією
                    window.location.href = "catalog.html?category=" + encodeURIComponent(selectedCategory);
                });
            });
        });

        function loadArticlesByCategory(category) {
            fetch(`/api/articles/${category}`)
                .then(function (response) {
                    return response.json();
                })
                .then(function (articles) {
                    var articlesContainer = document.getElementById("articlesContainer");
                    articlesContainer.innerHTML = ""; // Очистити попередні дані

                    articles.forEach(function(article) {
                        // Створіть контейнер блоку статті
                        var articleDiv = document.createElement("div");
                        articleDiv.className = "article-block";

                        // Додайте заголовок статті
                        var titleElement = document.createElement("h2");
                        titleElement.textContent = article.title;
                        articleDiv.appendChild(titleElement);

                        // Додайте зміст статті (перших 100 символів, наприклад)
                        var contentElement = document.createElement("p");
                        contentElement.className = "body_articles"
                        contentElement.innerText = stripHTMLTags(article.content.substring(0, 100));
                        if(article.content.substring>100){ " ..."};
                        articleDiv.appendChild(contentElement);

                        // Функція для видалення HTML-тегів
                        function stripHTMLTags(html) {
                            var doc = new DOMParser().parseFromString(html, 'text/html');
                            return doc.body.textContent || "";
                        }
                        // Якщо є зображення, додайте його
                        if (article.imageUrl) {
                            var imageElement = document.createElement("img");
                            imageElement.src = article.imageUrl;
                            imageElement.alt = "Зображення статті";
                            articleDiv.appendChild(imageElement);
                        }

                        // Додайте кнопку для перегляду статті
                        var viewButton = document.createElement("button");
                        viewButton.innerText = "Переглянути";
                        viewButton.className = "view-button";
                        // Оновлений код для кнопки "Переглянути"
                        viewButton.addEventListener("click", function () {
                            // Перейдіть на сторінку статті з ідентифікатором статті
                            var articleId = article.id; // Використовуйте ідентифікатор з об'єкта статті
                            window.location.href = "article.html?id=" + articleId;
                        });
                        articleDiv.appendChild(viewButton);

                        // Додайте блок статті до контейнера статей
                        articlesContainer.appendChild(articleDiv);
                    });
                })
                .catch(function (error) {
                    console.log("Помилка при отриманні списку статей:", error);
                });
        }
    </script>
</body>
</html>
